---
import '../styles/global.css';

interface Props {
	title: string;
    seoTitle?: string;
	description?: string;
    image?: string;
}

const { title, seoTitle, description = "A simple, fast, and modern website.", image = "/blog-placeholder-1.jpg" } = Astro.props;
const canonicalURL = new URL(Astro.url.pathname, Astro.site);
---

<!doctype html>
<html lang="en" data-theme="light">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="generator" content={Astro.generator} />

        <!-- Canonical URL -->
        <link rel="canonical" href={canonicalURL} />

        <!-- Primary Meta Tags -->
		<title>{seoTitle ?? title}</title>
		<meta name="title" content={seoTitle ?? title} />
		<meta name="description" content={description} />

        <!-- Open Graph / Facebook -->
        <meta property="og:type" content="website" />
        <meta property="og:url" content={Astro.url} />
        <meta property="og:title" content={title} />
        <meta property="og:description" content={description} />
        <meta property="og:image" content={new URL(image, Astro.url)} />

        <!-- Twitter -->
        <meta property="twitter:card" content="summary_large_image" />
        <meta property="twitter:url" content={Astro.url} />
        <meta property="twitter:title" content={title} />
        <meta property="twitter:description" content={description} />
        <meta property="twitter:image" content={new URL(image, Astro.url)} />

        <script type="application/ld+json" is:inline set:html={JSON.stringify({
            '@context': 'https://schema.org',
            '@type': 'Person',
            name: 'Diego Francisco Concepción',
            alternateName: 'costular',
            url: Astro.site?.toString() ?? canonicalURL.toString(),
            sameAs: [
                'https://github.com/costular',
                'https://x.com/costulardev',
                'https://www.linkedin.com/in/diegofranciscoconcepcion/',
            ],
        })} />

        <script is:inline>
            const storageKey = 'costular-theme';
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)');

            const getPreferredTheme = () => {
                const stored = localStorage.getItem(storageKey);
                if (stored === 'light' || stored === 'dark') return stored;
                return prefersDark.matches ? 'dark' : 'light';
            };

            const applyTheme = (theme, persist = false) => {
                document.documentElement.dataset.theme = theme;
                if (persist) localStorage.setItem(storageKey, theme);
            };

            applyTheme(getPreferredTheme());

            prefersDark.addEventListener('change', (event) => {
                const stored = localStorage.getItem(storageKey);
                if (stored === 'light' || stored === 'dark') return;
                applyTheme(event.matches ? 'dark' : 'light');
            });

            window.addEventListener('DOMContentLoaded', () => {
                const toggle = document.querySelector('[data-theme-toggle]');
                if (!toggle) return;

                const syncToggle = () => {
                    const isDark = document.documentElement.dataset.theme === 'dark';
                    toggle.setAttribute('aria-pressed', isDark ? 'true' : 'false');
                    toggle.setAttribute('aria-label', isDark ? 'Disable dark mode' : 'Enable dark mode');
                };

                syncToggle();

                toggle.addEventListener('click', () => {
                    const nextTheme = document.documentElement.dataset.theme === 'dark' ? 'light' : 'dark';
                    applyTheme(nextTheme, true);
                    syncToggle();
                });
            });
        </script>
	</head>
	<body class="bg-brutal text-brutal font-sans antialiased flex flex-col min-h-screen px-4 transition-colors duration-200">
		<header class="container mx-auto py-8 px-6 border-b-4 border-brutal bg-surface flex flex-col md:flex-row justify-between items-center gap-6 rounded-xl">
			<div class="flex flex-col items-start gap-2">
				<p class="text-sm font-bold leading-tight text-muted tracking-wide px-2">
					Diego Francisco Concepción aka
				</p>
				<a href="/" rel="author" class="text-4xl font-black tracking-tighter hover:bg-ink hover:text-ink-contrast px-2 transition-all rounded-lg">
					costular
				</a>
			</div>
			<nav class="flex gap-6 text-xl font-bold items-center">
				<a href="/" class="hover:underline decoration-4 underline-offset-4 decoration-primary px-1">Home</a>
				<a href="/blog" class="hover:underline decoration-4 underline-offset-4 decoration-primary px-1">Blog</a>
                <button
                    type="button"
                    class="theme-toggle brutal-shadow border-brutal"
                    data-theme-toggle
                    aria-label="Toggle theme"
                    aria-pressed="false"
                >
                    <span class="sr-only">Toggle dark mode</span>
                    <svg class="theme-icon-sun" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 18a6 6 0 1 1 0-12 6 6 0 0 1 0 12Zm0-2a4 4 0 1 0 0-8 4 4 0 0 0 0 8Zm0-12.5a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3Zm0 18a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3ZM4.318 6.318a1.5 1.5 0 1 1-2.122-2.122 1.5 1.5 0 0 1 2.122 2.122Zm17.486 17.486a1.5 1.5 0 1 1-2.122-2.122 1.5 1.5 0 0 1 2.122 2.122ZM1.5 13.5a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3Zm21 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3ZM4.318 21.804a1.5 1.5 0 0 1-2.12-2.122 1.5 1.5 0 0 1 2.12 2.122Zm15.364-15.364a1.5 1.5 0 1 1-2.122-2.12 1.5 1.5 0 0 1 2.122 2.12Z" />
                    </svg>
                    <svg class="theme-icon-moon" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M21.752 15.002a9.718 9.718 0 0 1-2.313.282c-5.385 0-9.75-4.365-9.75-9.75 0-.787.09-1.553.262-2.293a.75.75 0 0 0-1.184-.77C5.105 4.031 3 7.288 3 11c0 5.385 4.365 9.75 9.75 9.75 3.712 0 6.97-2.105 8.53-5.768a.75.75 0 0 0-.528-.98Z" />
                    </svg>
                </button>
			</nav>
		</header>

		<main class="flex-grow container mx-auto px-6 py-16">
			<slot />
		</main>

		<footer class="container mx-auto px-6 py-8 text-center border-t-4 border-brutal bg-surface rounded-xl space-y-2">
			<p class="font-semibold text-base text-muted tracking-tight">
				Costular.com © {new Date().getFullYear()}
			</p>
			<p class="text-sm font-medium text-brutal">
				Content CC BY-SA 4.0 | Code MIT | Contact:
				<a href="mailto:costular@gmail.com" class="underline decoration-2 underline-offset-4 decoration-primary">
					costular@gmail.com
				</a>
			</p>
			<div class="flex flex-wrap justify-center gap-4 text-sm font-semibold">
				<a href="/aviso-legal" class="hover:underline decoration-2 underline-offset-4 decoration-primary px-1">Legal Notice</a>
				<a href="/politica-privacidad" class="hover:underline decoration-2 underline-offset-4 decoration-primary px-1">Privacy Policy</a>
			</div>
			<p class="text-xs text-muted italic">Fueled by matcha.</p>
		</footer>
	</body>
</html>
