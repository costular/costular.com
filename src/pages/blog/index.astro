---
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';
import { calculateReadingTime } from '../../utils/readingTime';

const posts = (await getCollection('blog')).sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);
---

<Layout title="Blog | Diego" description="Read my thoughts on software engineering and more." lang="en">
	<section>
		<h1 class="text-4xl md:text-5xl font-black mb-16 border-b-8 border-brutal pb-8">Blog</h1>
		<ul class="space-y-12">
			{
				posts.map((post) => (
					<li class="relative">
                        <a href={`/blog/${post.data.lang}/${post.slug}/`} class="block group">
                            <div class="absolute inset-0 bg-ink translate-x-2 translate-y-2 group-hover:translate-x-4 group-hover:translate-y-4 transition-transform rounded-lg"></div>
                            <article class="relative bg-surface border-4 border-brutal p-8 group-hover:-translate-y-1 group-hover:-translate-x-1 transition-transform rounded-lg">
                                <div class="flex flex-col md:flex-row md:items-baseline md:justify-between mb-4 gap-2">
                                    <h2 class="text-3xl md:text-4xl font-black group-hover:text-primary transition-colors">
                                        {post.data.title}
                                    </h2>
                                    <div class="flex items-center gap-3 text-sm font-bold text-gray-600">
                                        <span class="flex items-center gap-2">
                                            <span aria-hidden="true">{post.data.lang === 'es' ? 'ðŸ‡ªðŸ‡¸' : 'ðŸ‡¬ðŸ‡§'}</span>
                                            <span>
                                                {post.data.lang === 'es' ? 'EspaÃ±ol' : 'English'}
                                            </span>
                                        </span>
                                        <span aria-hidden="true">â€¢</span>
                                        <span class="font-bold text-muted tracking-wide">
                                            {calculateReadingTime(post.body || "")}
                                        </span>
                                        <span aria-hidden="true">â€¢</span>
                                        <time datetime={post.data.pubDate.toISOString()} class="font-bold bg-primary text-primary-foreground px-2 py-1 border-2 border-brutal whitespace-nowrap rounded-lg">
                                            {post.data.pubDate.toLocaleDateString('en-us', {
                                                year: 'numeric',
                                                month: 'short',
                                                day: 'numeric',
                                            })}
                                        </time>
                                    </div>
                                </div>
                                <p class="text-xl font-bold text-brutal leading-relaxed border-l-4 border-muted pl-4">
                                    {post.data.description}
                                </p>
                            </article>
						</a>
					</li>
				))
			}
		</ul>
	</section>
</Layout>
